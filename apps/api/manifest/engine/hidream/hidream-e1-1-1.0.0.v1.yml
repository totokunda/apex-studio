api_version: apex/v1
kind: Model
metadata:
  id: hidream-e1-1
  model: hidream
  name: Hidream E1-1
  version: 1.0.0
  description: Hidream is a 17B parameter model for image generation with edit capabilities.
  tags:
  - hidream
  - edit
  author: Apex AI
  license: Apache-2.0
  demo_path: https://miro.medium.com/v2/resize:fit:1400/0*E8anr2J8q4wbfdd0
  categories:
  - image-edit
spec:
  engine: hidream
  model_type: edit
  engine_type: torch
  denoise_type: edit
  attention_types:
  - sdpa
  components:
  - type: scheduler
    label: Scheduler
    default: UniPCMultistepScheduler
    scheduler_options:
    - name: UniPCMultistepScheduler
      label: UniPC Multistep Scheduler
      description: Multi-step predictor-corrector scheduler for HiDream generation.
      base: diffusers.UniPCMultistepScheduler
      config_path: HiDream-ai/HiDream-E1-1/scheduler/scheduler_config.json
  - type: vae
    label: HiDream VAE
    base: auto
    model_path:
    - path: HiDream-ai/HiDream-I1-Full/vae
      variant: default
      file_size: 167667722
  - type: text_encoder
    name: text_encoder
    label: CLIP Text Encoder
    base: CLIPTextModelWithProjection
    model_path:
    - path: HiDream-ai/HiDream-I1-Full/text_encoder
      variant: default
      file_size: 495150452
    tokenizer_class: CLIPTokenizer
    tokenizer_name: HiDream-ai/HiDream-I1-Full
    tokenizer_kwargs:
      subfolder: tokenizer
  - type: text_encoder
    name: text_encoder_2
    label: CLIP Text Encoder 2
    base: CLIPTextModelWithProjection
    model_path:
    - path: HiDream-ai/HiDream-I1-Full/text_encoder_2
      variant: default
      file_size: 2779424760
    tokenizer_class: CLIPTokenizer
    tokenizer_name: HiDream-ai/HiDream-I1-Full
    tokenizer_kwargs:
      subfolder: tokenizer_2
  - type: text_encoder
    name: text_encoder_3
    label: T5 Text Encoder
    base: T5EncoderModel
    model_path:
    - path: HiDream-ai/HiDream-I1-Full/text_encoder_3
      variant: default
      file_size: 9524669210
    tokenizer_class: T5Tokenizer
    tokenizer_name: HiDream-ai/HiDream-I1-Full
    tokenizer_kwargs:
      subfolder: tokenizer_3
  - type: helper
    name: llama
    label: Llama 3.1 Instruct Helper
    base: hidream.llama
    model_path:
    - path: meta-llama/Llama-3.1-8B-Instruct
      variant: default
      file_size: 32132582323
  - type: transformer
    label: HiDream Transformer
    base: hidream.base
    config_path: https://huggingface.co/HiDream-ai/HiDream-E1-1/resolve/main/transformer/config.json
    model_path:
    - path: HiDream-ai/HiDream-E1-1/transformer
      variant: default
      file_size: 34211855409
    - path: https://huggingface.co/QuantStack/HiDream-E1-1-GGUF/resolve/main/HiDream_E1_1_-Q2_K.gguf
      variant: GGUF_Q2_K
      precision: q2_k
      type: gguf
      resource_requirements:
        min_vram_gb: 12
        recommended_vram_gb: 16
      file_size: 6567249600
    - path: https://huggingface.co/QuantStack/HiDream-E1-1-GGUF/resolve/main/HiDream_E1_1_-Q4_K_S.gguf
      variant: GGUF_Q4_K_S
      precision: q4_k_s
      type: gguf
      resource_requirements:
        min_vram_gb: 14
        recommended_vram_gb: 20
      file_size: 10898851520
    - path: https://huggingface.co/QuantStack/HiDream-E1-1-GGUF/resolve/main/HiDream_E1_1_-Q6_K.gguf
      variant: GGUF_Q6_K
      precision: q6_k
      type: gguf
      resource_requirements:
        min_vram_gb: 18
        recommended_vram_gb: 28
      file_size: 14684456640
    - path: https://huggingface.co/QuantStack/HiDream-E1-1-GGUF/resolve/main/HiDream_E1_1_-Q8_0.gguf
      variant: GGUF_Q8_0
      precision: q8_0
      type: gguf
      resource_requirements:
        min_vram_gb: 24
        recommended_vram_gb: 36
      file_size: 18694358720
  defaults:
    run:
      num_inference_steps: 40
      guidance_scale: 5.0
      return_latents: false
      text_encoder_kwargs:
        add_special_tokens: false
        clean_text: false
        max_sequence_length: 128
      text_encoder_2_kwargs:
        add_special_tokens: false
        clean_text: false
        max_sequence_length: 128
      text_encoder_3_kwargs:
        add_special_tokens: true
        clean_text: false
        use_attention_mask: true
        pad_with_zero: false
        max_sequence_length: 128
      attention_kwargs: {}
  ui:
    panels:
    - name: input
      label: Input
      collapsible: true
      default_open: true
      layout:
        flow: column
        rows:
        - - image
    - name: prompting
      label: Prompting
      collapsible: true
      layout:
        flow: column
        rows:
        - - prompt
    - name: advanced_prompting
      label: Advanced Prompting
      collapsible: true
      default_open: false
      layout:
        flow: column
        rows:
        - - negative_prompt
    - name: size
      label: Size
      collapsible: true
      layout:
        flow: column
        rows:
        - - resolution
        - - aspect_ratio
        - - height
          - width
    - name: sampling
      label: Sampling
      collapsible: true
      layout:
        flow: column
        rows:
        - - num_inference_steps
        - - guidance_scale
        - - seed
    inputs:
    - id: image
      label: Image
      description: The image to edit.
      type: image
      panel: input
      required: true
      map_h: height
      map_w: width
      scale_by: resolution
    - id: prompt
      label: Prompt
      description: Describe the image you want to generate.
      placeholder: A cinematic portrait lighting a subject with rim light, 85mm lens.
      type: text
      panel: prompting
      required: true
    - id: negative_prompt
      label: Negative Prompt
      description: Describe what you want to avoid in the generation.
      placeholder: blurry, low quality, distorted, artifacts
      default: lowres, text, error, cropped, worst quality, low quality, jpeg artifacts,
        ugly, duplicate, morbid, mutilated, out of frame, extra fingers, mutated hands,
        poorly drawn hands, poorly drawn face, mutation, deformed, blurry, dehydrated,
        bad anatomy, bad proportions, extra limbs, cloned face, disfigured, gross
        proportions, malformed limbs, missing arms, missing legs, extra arms, extra
        legs, fused fingers, too many fingers, long neck, username, watermark, signature
      type: text
      panel: advanced_prompting
      required: false
    - id: resolution
      label: Resolution
      description: Select the resolution of the output image
      panel: size
      type: select
      default: 720
      options:
      - name: HD
        value: 720
      - name: Ultra HD
        value: 1024
      - name: SD
        value: 480
      - name: Custom
        value: custom
    - id: aspect_ratio
      label: Aspect Ratio
      description: Select the aspect ratio of the output image
      panel: size
      type: select
      default: "16:9"
      options:
      - name: Wide
        value: "16:9"
        ratio_w: 16
        ratio_h: 9
      - name: Vertical
        value: "9:16"
        ratio_w: 9
        ratio_h: 16
      - name: Square
        value: "1:1"
        ratio_w: 1
        ratio_h: 1
      - name: Classic
        value: "4:3"
        ratio_w: 4
        ratio_h: 3
      - name: Custom
        value: custom
    - id: num_inference_steps
      label: Inference Steps
      description: Number of denoising steps
      type: number+slider
      value_type: integer
      panel: sampling
      default: 40
      min: 1
      max: 100
      step: 1
    - id: height
      label: Height
      description: Explicit height override
      type: number
      value_type: integer
      panel: size
      default: 1024
      min: 256
      max: 8192
      step: 64
    - id: width
      label: Width
      description: Explicit width override
      type: number
      value_type: integer
      panel: size
      default: 1024
      min: 256
      max: 8192
      step: 64
    - id: seed
      label: Seed
      description: Random seed for reproducibility
      type: random
      default: -1
      min: 0
      max: 4294967295
      value_type: integer
      panel: sampling
      required: false
    - id: guidance_scale
      label: Guidance Scale
      type: number+slider
      value_type: float
      panel: sampling
      required: false
      default: 3.0
      min: 1.0
      max: 15.0
      step: 0.5
    - id: image_guidance_scale
      label: Image Guidance Scale
      type: number+slider
      value_type: float
      panel: sampling
      required: false
      default: 1.5
      min: 0.0
      max: 5.0
      step: 0.1
    - id: refine_strength
      label: Refine Strength
      type: number+slider
      value_type: float
      panel: sampling
      required: false
      default: 0.3
      min: 0.0
      max: 1.0
      step: 0.01
